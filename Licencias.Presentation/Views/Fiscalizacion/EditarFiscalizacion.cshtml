@using Licencias.Presentation.Core
@model Licencias.Presentation.Models.FiscalizacionModel

@{
    ViewBag.Title = "Editar";
}

@section StyleContent
{
    <link href="@Url.Content("~/Content/css/select2.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/css/jquery-ui.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/css/dropzone.css")" rel="stylesheet" type="text/css" />

    <style type="text/css">
        .ui-datepicker-month, .ui-datepicker-year {
            color: black;
        }
    </style>
}

<div class="box box-info">
    <div class="box-header with-border">
        <h3 class="box-title">Actualizar Fiscalización</h3>
    </div>
    @using (Html.BeginForm("EditarFiscalizacion", "Fiscalizacion", new { area = "" }, FormMethod.Post, new { id = "frmFiscalizacion", @class = "form-horizontal" }))
    {
        @Html.AntiForgeryToken()
        
        <div class="box-body">
            <div class="form-group">
                @Html.LabelFor(p => p.NumLicencia, new { @class = "col-sm-2 control-label" })
                <div class="col-sm-4">
                    @Html.TextBoxFor(p => p.NumLicencia, new { @class = "form-control", @disabled = "disabled" })
                </div>
                <a class="btn btn-social btn-success" href="@Model.UriImagen">
                    <i class="fa fa-instagram"></i> Ver Imagen
                </a>
            </div>
            <div class="form-group">
                @Html.LabelFor(p => p.LocalDireccion, new { @class = "col-sm-2 control-label" })
                <div class="col-sm-8">
                    @Html.TextBoxFor(p => p.LocalDireccion, new { @class = "form-control", @disabled = "disabled" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(p => p.EstadoId, new { @class = "col-sm-2 control-label" })
                <div class="col-sm-8">
                    @Html.DropDownListFor(p => p.EstadoId, Utils.SelectEstadoFiscalizacion(), new { @class = "form-control" })
                    <div class="help-block">@Html.ValidationMessageFor(p => p.EstadoId)</div>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(p => p.FechaFiscalizacion, new { @class = "col-sm-2 control-label" })
                <div class="col-sm-4">
                    @Html.TextBoxFor(p => p.FechaFiscalizacion, new { @class = "form-control", @maxlength = 10 })
                    <div class="help-block">@Html.ValidationMessageFor(p => p.FechaFiscalizacion)</div>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(p => p.Detalle, new { @class = "col-sm-2 control-label" })
                <div class="col-sm-8">
                    @Html.TextAreaFor(p => p.Detalle, new { @class = "form-control", @maxlength = 1000 })
                    <div class="help-block">@Html.ValidationMessageFor(p => p.Detalle)</div>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(p => p.Observacion, new { @class = "col-sm-2 control-label" })
                <div class="col-sm-8">
                    @Html.TextAreaFor(p => p.Observacion, new { @class = "form-control", @maxlength = 1000 })
                    <div class="help-block">@Html.ValidationMessageFor(p => p.Observacion)</div>
                </div>
            </div>
            <div class="form-group">
                @Html.HiddenFor(p => p.Id)
            </div>
        </div>
        <div class="box-footer">
            <div class="col-md-offset-3 col-md-9">
                <a class="btn btn-default" href="@Url.Action("Fiscalizaciones", "Fiscalizacion")">
                    <i class="fa fa-reply"></i>
                    Regresar
                </a>
                &nbsp; &nbsp; &nbsp;
                <button type="submit" class="btn btn-info">
                    <i class="fa fa-floppy-o"></i>
                    Guardar
                </button>
            </div>
        </div>
    }
    <div class="panel-body" style="padding: 5px 20px 5px 20px;">

        <form action="/upload" class="dropzone" drop-zone="" id="file-dropzone"></form>
        <button id="submit-all" class="btn btn-primary">Subir imagenes</button>
        <a href="@Url.Action("Index")" class="btn btn-default">Regresar</a>
    </div>
</div>

@section ScriptContent
{
    <script src="@Url.Content("~/Content/js/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/js/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/js/dropzone.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/js/select2.min.js")"></script>
    <script src="@Url.Content("~/Content/js/i18n/es.js")"></script>
    <script src="@Url.Content("~/Content/js/jQuery/jquery-ui.min.js")"></script>
    <script src="@Url.Content("~/Content/js/jQuery/datepicker-es.js")" type="text/javascript"></script>

    <script type="text/javascript">
    $("#frmFiscalizacion").on("submit", function (e) {
        if (!$(this).valid()) {
            e.preventDefault();
            return;
        }

        var form = webApp.getDataForm(this);

        webApp.showConfirmDialog(function () {
            $.ajax({
                url: form.url,
                type: form.type,
                data: form.data,
                success: function (response) {
                    if (response.Success === true) {
                        webApp.showMessageDialog(function () {
                            window.location.href = "@Url.Action("Fiscalizaciones", "Fiscalizacion")";
                        }, response.Message);
                    } else
                        webApp.showMessageDialog(function () { }, response.Message);
                },
                error: function (x, xh, xhr) {
                    console.error(xh);
                },
                complete: function () {
                }
            });
        });

        e.preventDefault();
    });

    $("#FechaFiscalizacion").datepicker({
        changeMonth: true,
        changeYear: true,
        option: $.datepicker.regional['es'],
        yearRange: "@DateTime.Today.Year:+0"
        });

    $('#file-dropzone').dropzone({
        url: "/upload",
        maxFilesize: 100,
        paramName: "uploadfile",
        maxThumbnailFilesize: 5,
        init: function () {

            this.on('success', function (file, json) {
            });

            this.on('addedfile', function (file) {

            });

            this.on('drop', function (file) {
                alert('file');
            });
        }
    });

    </script>
}
