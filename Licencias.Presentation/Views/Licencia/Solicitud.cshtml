@model Licencias.Presentation.Models.SolicitudLicenciaModel

@{
    ViewBag.Title = "Index";
    ViewBag.Index = 1;
}

@section StyleContent
{
    <link href="@Url.Content("~/Content/css/select2.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("~/Content/css/jquery-ui.min.css")" rel="stylesheet" type="text/css" />
    <style type="text/css">
        .ui-datepicker-month, .ui-datepicker-year {
            color: black;
        }
    </style>
}

<div class="box box-info">
    <div class="box-header with-border">
        <h3 class="box-title">Actualizar Cronograma</h3>
    </div>
    @using (Html.BeginForm(Model.Accion, "Licencia", new { area = "" }, FormMethod.Post, new { id = "frmLicencia", @class = "form-horizontal" }))
    {
        @Html.AntiForgeryToken()

        <div class="box-body">
            <div class="form-group">
                @Html.LabelFor(p => p.Solicitante, new { @class = "col-sm-2 control-label" })
                <div class="col-sm-4">
                    @Html.TextBoxFor(p => p.Solicitante, new { @class = "form-control" })
                    <div class="help-block">@Html.ValidationMessageFor(p => p.Solicitante)</div>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(p => p.GiroId, new { @class = "col-sm-2 control-label" })
                <div class="col-sm-8">
                    @Html.DropDownListFor(p => p.GiroId, new SelectList(Model.GiroList, "Id", "Descripcion", Model.GiroId), new { @class = "form-control" })
                    <div class="help-block">@Html.ValidationMessageFor(p => p.GiroId)</div>
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(p => p.AdministradoId, new { @class = "col-sm-2 control-label" })
                <div class="col-sm-8">
                    @Html.DropDownListFor(p => p.AdministradoId, new SelectList(Model.AdministradoList, "Id", "Nombres", Model.AdministradoId), new { @class = "form-control" })
                    <div class="help-block">@Html.ValidationMessageFor(p => p.AdministradoId)</div>
                </div>
            </div>
            <div class="form-group">
                @Html.HiddenFor(p => p.Id)
            </div>
        </div>
        <div class="box-footer">
            <div class="col-md-offset-3 col-md-9">
                <a class="btn btn-default" href="@Url.Action("Index", "Solicitud")">
                    <i class="fa fa-reply"></i>
                    Regresar
                </a>
                &nbsp; &nbsp; &nbsp;
                <button type="submit" class="btn btn-info">
                    <i class="fa fa-floppy-o"></i>
                    Guardar
                </button>
            </div>
        </div>
    }
</div>

@section ScriptContent
{
    <script src="@Url.Content("~/Content/js/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/js/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Content/js/select2.min.js")"></script>
    <script src="@Url.Content("~/Content/js/i18n/es.js")"></script>
    <script src="@Url.Content("~/Content/js/jQuery/jquery-ui.min.js")"></script>
    <script src="@Url.Content("~/Content/js/jQuery/datepicker-es.js")" type="text/javascript"></script>

    <script type="text/javascript">
        $("#frmLicencia").on("submit", function(e) {
            if (!$(this).valid()) {
                e.preventDefault();
                return;
            }

            var form = webApp.getDataForm(this);

            webApp.showConfirmDialog(function() {
                $.ajax({
                    url: form.url,
                    type: form.type,
                    data: form.data,
                    success: function(response) {
                        if (response.Success === true) {
                            webApp.showMessageDialog(function() {
                                window.location.href = "@Url.Action("Index", "Fiscalizacion")";
                            }, response.Message);
                        } else
                            webApp.showMessageDialog(function() {}, response.Message);
                    },
                    error: function(x, xh, xhr) {
                        console.error(xh);
                    },
                    complete: function() {
                    }
                });
            });

            e.preventDefault();
        });


        $("#Giro").select2({
            language: "es",
            minimumInputLength: 3,
            minimumResultsForSearch: 10,
            delay: 250,
            allowClear: true
        });

        $("#FiscalizadorId").select2({
            language: "es",
            minimumInputLength: 3,
            minimumResultsForSearch: 10,
            delay: 250,
            allowClear: true
        });

        $("#Direccion").on("select2:select", function(e) {
            $('#NumLicencia').val(e.params.data.numLicencia);
            $('#LicenciaId').val(e.params.data.id);
        });
    </script>
}